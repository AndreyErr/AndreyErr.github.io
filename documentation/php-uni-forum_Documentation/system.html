<!DOCTYPE html>
<html lang="ru">
  <head>
    <!-- Title -->
    <title>Документация | Система</title>
  
    <!-- Required Meta Tags Always Come First -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
    <!-- Favicon -->
    <link rel="shortcut icon" href="../favicon.png">
  
    <meta name="keywords" content="">
    <meta name="description" content="Документация">
    <meta name="author" content="htmlstream.com, Андрей сорокин">

    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="../assets/vendor/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="../assets/vendor/jquery-ui/themes/base/jquery-ui.min.css">
    <link rel="stylesheet" href="../assets/vendor/prism/prism.css">
  
    <!-- CSS Implementing Plugins -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">

  <!-- CSS Template -->
  <link rel="stylesheet" href="../assets/css/theme.css">
  <link rel="stylesheet" href="../assets/css/layout.css">
</head>
<body class="bg-white">
  <div class="container-fluid">
    <div class="row">
      <!-- Sidebar -->
      <nav class="col-md-4 col-lg-3 col-xl-2 bg-dark text-white duik-sidebar duik-sidebar--dark ui-autocomplete-wrapper--dark navbar-expand-md pt-0">
        <div class="d-flex justify-content-between bg-black-soft w-100">
          <a class="d-block w-md-100 p-3 mr-md-0 navbar-brand text-light" href="../index.html">
            AndreyErrDocs
          </a>

          <!-- Responsive Toggle Button -->
          <button class="btn btn-link text-white pl-0 d-md-none" type="button" data-toggle="collapse" data-target="#sidebar-nav" aria-controls="sidebar-nav" aria-expanded="false" aria-label="Toggle navigation">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 30 30" width="30" height="30" focusable="false">
              <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-miterlimit="10" d="M4 7h22M4 15h22M4 23h22"/>
            </svg>
          </button>
          <!-- End Responsive Toggle Button -->
        </div>

        <!-- Sidebar Nav -->
        <div class="collapse navbar-collapse" id="sidebar-nav">
          <div class="js-scrollbar duik-sidebar-sticky duik-sidebar-sticky--mini">
            <ul class="duik-sidebar__nav">
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../php-uni-forum_Documentation/start.html">Начало</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../php-uni-forum_Documentation/files.html">Файлы</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link active" href="../php-uni-forum_Documentation/system.html">Система</a></li>
              <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="#!">Дальше - больше...</a></li>
            </ul>
          </div>
        </div>
        <!-- End Sidebar Nav -->

        <hr class="mt-0 mt-md-3 mb-4">

        <!-- Fast Links -->
        <ul class="duik-sidebar__nav mb-0">
          <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="../php-uni-forum_Documentation/index.html"><i class="fa-solid fa-house mr-2"></i> Начало</a></li>
          <li class="duik-sidebar__item"><a class="duik-sidebar__link" href="https://github.com/AndreyErr/php-uni-forum" target="_blank"><i class="fa-brands fa-github mr-2"></i> Репозиторий</a></li>
        </ul>
        <!-- End Fast Links -->

        <hr class="mt-0 mt-md-3 mb-4">

        <div class="px-3 pb-5">
          <a class="btn btn-sm btn-block btn-primary" href="https://github.com/AndreyErr/php-uni-forum/releases" title="Скачать" target="_blank"><i class="fas fa-cloud-download-alt mr-1"></i> Скачать код</a>
        </div>
      </nav>
      <!-- End Sidebar -->

      <main class="ml-sm-auto col-md-8 col-lg-9 col-xl-10 px-4 pt-4">
        <div class="row pt-3">
          <!-- Content Nav -->
          <div class="col-xl-2 order-xl-2 d-none d-xl-inline-block">
            <ul class="js-scroll-nav duik-content-nav top-3">
              <li class="duik-content-nav__item"><a href="#arh">Архитектура</a></li>
              <li class="duik-content-nav__item">
                <a href="#core">Ядро и работа с ним</a>
                <ul>
                  <li class="duik-content-nav__item"><a href="#ind">index.php</a></li>
                  <li class="duik-content-nav__item"><a href="#rout">Роутер</a></li>
                  <li class="duik-content-nav__item"><a href="#cont">Контроллер</a></li>
                  <li class="duik-content-nav__item"><a href="#model">Модель</a></li>
                  <li class="duik-content-nav__item"><a href="#view">Представление</a></li>
                </ul>
              </li>
              <li class="duik-content-nav__item"><a href="#next">Что дальше</a></li>
            </ul>
          </div>
          <!-- End Content Nav -->

          <!-- Content -->
          <div class="col-xl-10 order-xl-1 duik-content-2 border-bottom">
            <div class="border-bottom mb-7">
              <h1 class="font-weight-bold">Система</h1>
              <p class="lead mb-5">В этой главе мы расскажем вам, как устроены внутренности проекта и как с ними взаимодействовать.</p>
            </div>

            <div id="arh" class="mb-7">
              <h2 class="h4 font-weight-bold">Архитектура  <a class="js-anchor-link duik-anchorjs-link" href="#arh" aria-label="Anchor" data-anchorjs-icon="#"></a></h2>
              <p>Архитектурным паттерно проекта, как это неоднократно указывалось ранее, является паттерн <code>MVC</code> - модель проедставление и контроллер.
              Этот паттерн позволяет разделить проет на 3 понятные логические части, с которыми будет легко работать. Разберём подробнее каждую из них:</p>
              <p><code>Контроллер</code> - представлено файлом <code>system/controller.php</code> - родительский класс, который разбивает запрос на составляющие и подключает представление и модель.</p>
              <p><code>Модель</code> - представлено файлом <code>system/model.php</code> - родительский класс, который содержит методы, используемые более чем в одном модуле.</p>
              <p><code>Представление</code> - представлено файлом <code>system/view.php</code> - класс представления данных, который вызывает представления и передаёт им данные.</p>
              <p>Весь проект поделён на модули и в каждом модуле уже используется указанные паттерн. Сделано это для более лёгкого разбития проекта на составляющие.
                Направляет запросы в нужный модуль ещё один важный элемент - <code>роутер</code>!
              </p>
              <p><code>Роутер</code> - представлено файлом <code>system/router.php</code> - класс, который определяет, в какой контроллер отправить запрос.</p>
              <p>Общий вид архитектуры можно представить следующим образом:</p>
              <div class="mb-7">
                <img class="shadow img-fluid rounded mt-1" src="../files/img/docIm1.png" alt="Htmlstream">
              </div>
              <p>Пользователь отправляет некий запрос в виде ссылки. Его перехватывает роутер и в зависимости от ссылки решает, какому контроллеру этот запрос передать.
                После передачи контроллеру, последний разбивает запрос на составляющие и запрашивает обработку данных и/или их получение из модели.
                Далее контроллер передаёт полученные данные представлению, которое уже рендерит страницу с заданными параметрами.
              </p>
              <div class="duik-callout duik-callout-danger mb-5">
                <h4 class="h5">Внимание</h4>
                <p class="mb-0">Настроящая версия проекта не позволяет обнавлять страницу частично!</p>
                <p class="mb-0">Обновляется страница искючительно полностью!</p>
              </div>
              <p>Полная схема взаимодействия в проекте выглядит следующим образом (сделано на основе модуля форума):</p>
              <div class="mb-7">
                <img class="shadow img-fluid rounded mt-1" src="../files/img/docIm2.png" alt="Htmlstream">
              </div>
              <p>Разберём эту схему подробнее.</p>
              <p>Некий запрос приходит еа роутер. Этот роутер, при помощи настроек доступа (access) проверяет доступ у пользователя к модулю. Например, доступа может не быть, если пользователь не абминистратор.
                Дальше роутер перенаправляет запрос в контроллер нужного модуля. Контроллер модуля всегда имеет вид <code>*name*C (forumC)</code>.
                Контроллер пользуется родительским классом, расположенным в ядре! Так же он проверяет доступ пользователя к определённой странице при помощи настроек доступа ,
                после чего запрашивает что-то у модели, если это необходимо.<br> Модель, пользуясь родительским классом, расположенным в ядре, использует библиотеки и все настройки для работы с данными. 
                Так же только модель работает с базой данных. Модель модуля всегда имеет вид <code>*name*M (forumM)</code>.<br>
                Получив данные от модели, контроллер собирает их и отправляет в представление. Функционал представления расположена только в ядре и не может быть изменён под модули. 
                Но были созданы все необходимые инструменты для отображения проекта. Вы пожете использовать общесайтовые представления или их части или представления созданные специально под конкретные модули.
              </p>
            </div>

            <div id="core" class="mb-7">
              <h2 class="h4 font-weight-bold">Ядро и работа с ним  <a class="js-anchor-link duik-anchorjs-link" href="#core" aria-label="Anchor" data-anchorjs-icon="#"></a></h2>
              <p>Выше уже описывалось что зачем нужно, поэтому здесь мы посмотрим как это использовать. Рассматриваться будут классы ядра системы и их методы и/или что-то ещё, но исключительно то, что вы можете использовать! Всё это актуально для существующей последней версии.</p>
              <div id="ind">
                <h2 class="h4 font-weight-bold">index.php  <a class="js-anchor-link duik-anchorjs-link" href="#ind" aria-label="Anchor" data-anchorjs-icon="#"></a></h2>
                <p><code>index.php</code> - стартовый файл, у которого только 2 задачи: запустить приложение и сделать то, что необходимо прямо на старте.</p>
              </div>
              <div id="rout">
                <h2 class="h4 font-weight-bold">Роутер  <a class="js-anchor-link duik-anchorjs-link" href="#rout" aria-label="Anchor" data-anchorjs-icon="#"></a></h2>
                <p>Все методы в нём созданы исключительно для функционирования ядра, поэтому там не рекомендуется ничего менять. У этого класса нет публичных методов!</p>
              </div>
              <div id="cont">
                <h2 class="h4 font-weight-bold">Контроллер  <a class="js-anchor-link duik-anchorjs-link" href="#cont" aria-label="Anchor" data-anchorjs-icon="#"></a></h2>
                <p>Все методы в нём созданы исключительно для функционирования ядра, поэтому там не рекомендуется ничего менять. У этого класса нет публичных методов!</p>
              </div>
              <div id="model">
                <h2 class="h4 font-weight-bold">Модель  <a class="js-anchor-link duik-anchorjs-link" href="#model" aria-label="Anchor" data-anchorjs-icon="#"></a></h2>
                <div class="duik-callout duik-callout-primary mb-5">
                  <h4 class="h5">Метод <b><code>specialDataGet</code></b></h4>
                  <p class="mb-0">Получает данные из настроек <code>config_data.php</code>.</p>
                  <p class="mb-0">Запрос настройки по форме xxx/xxx/xx, в зависимости от последовотельности массивов.</p>
                  <p class="mb-0">Пример: у нас есть следующая запись в файле config_data.php:</p>
                  <p class="mb-0"><pre>
'fileData' => [
    'avatar' => [
        'maxSize' => 2097152
    ],
],</pre></p>
                  <p class="mb-0">Соответствено, чтобы получит значение элемента 'maxSize', мы должны ввести следующий хапрос: 'fileData/avatar/maxSize'.</p>
                  <p class="mb-0">Входные данные: (
                    <ol>
                      <li>Путь к нужному элементу из файла <code>config_data.php</code> - string - ОБЯЗАТЕЛЬНО</li>
                    </ol>
                  </p>
                  <p class="mb-0">Выходные данные: (
                    <ol>
                      <li>Вывод из данного элемента</li>
                      <li>Ошибка - не найдено настройка (нечего не найдено по запрашиваемому пути)</li>
                    </ol>
                  </p>
                </div>
                <div class="duik-callout duik-callout-primary mb-5">
                  <h4 class="h5">Метод <b><code>selectUnits</code></b></h4>
                  <p class="mb-0">Выбирает главные темы (юниты) из базы данных.</p>
                  <p class="mb-0">Входные данные: (
                    <ol>
                      <li>Кол-во запрашиваемых тем (по умолчанию 100) - string - ОПЦИОНАЛЬНО</li>
                    </ol>
                  </p>
                  <p class="mb-0">Выходные данные: (
                    <ol>
                      <li>Темы или их отсутствие</li>
                    </ol>
                  </p>
                </div>
                <div class="duik-callout duik-callout-primary mb-5">
                  <h4 class="h5">Метод <b><code>fileUpload</code></b></h4>
                  <p class="mb-0">Проверяет и загружает файл.</p>
                  <p class="mb-0">Входные данные: (
                    <ol>
                      <li>Тип файла (должен быть такой же, как и название поля загрузки файлов в форме html, требуются настройки в config_data.php) - string - ОБЯЗАТЕЛЬНО</li>
                      <li>Файл (объект) - массив параметров - ОБЯЗАТЕЛЬНО</li>
                      <li>Новое имя файла - string - ОБЯЗАТЕЛЬНО</li>
                      <li>Новое расширение файла - string - ОПЦИОНАЛЬНО</li>
                      <li>Нестандартный путь (в дополнение к основному из файла настроек) - string - ОПЦИОНАЛЬНО</li>
                    </ol>
                  </p>
                  <p class="mb-0">Выходные данные: (
                    <ol>
                      <li>OK - string - удачная загрузка файла</li>
                      <li>Ошибка загрузки с её описанием</li>
                    </ol>
                  </p>
                  <p class="mb-0">Необходимые настройки файла в config_data.php: (
                    <ol>
                      Обязательно :
                      <li>mimeTypeCheck (главный) - проверку по mime-типу для всех типов файлов</li>
                      <li>FILE_SERVER (главный) - файловый сервер</li>
                      --------<br>
                      Обязательно для конкретного типа файлов:
                      <li>folder - папка хранения изображений на сервере в папке dinamic (начинать путь с <code>/</code>, например /files/img/avatar/)</li>
                      <li>extensions - массив разрешённых расширений файла (выглядит как <code>array('png', 'jpeg', 'jpg')</code>)</li>
                      <li>mimeExtensions - массив разрешённых mime-типов файла (выглядит как <code>array('png', 'jpeg', 'jpg')</code>)</li>
                      <li>maxSize - максимальный размер загружаемого файла в байтах</li>
                      <li>maxFilesCount - максимальное кол-во загружаемых файлов для данного типа</li>
                      Опционально:
                      <li>'mimeTypeCheck' => false - выключить проверку по mime-типу для данного типа файлов</li>
                    </ol>
                  </p>
                  <p>Пример части файла:
                    <pre>
'mimeTypeCheck' => true, // (главный)
'FILE_SERVER' => $_SERVER['DOCUMENT_ROOT'],

'fileData' => [
    'avatar' => [
        'mimeTypeCheck' => false, // Проверка по mime-типуб возможность её отключения именно для этой загрузки (если включена возможность)
        'folder' => '/files/img/avatar/', // Папка хранения изображений на сервере
        // Следующие 2 строчки должны иметь одинаковое кол-во значений! Иначе проверка "mimeTypeCheck" может не пройти!
        'extensions' => array('png', 'jpeg', 'jpg'), // тип (Для проверки типа ".something")
        'mimeExtensions' => array('png', 'jpeg', 'jpg'), // mime-тип (Для проверки meme-типа (сигнатуры). Список: https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_MIME-%D1%82%D0%B8%D0%BF%D0%BE%D0%B2)
        'maxSize' => 2097152, // В байтах / 2мб
        'maxFilesCount' => 1, // Сколько разрешено загружать файлов одновременно
    ],
],
                    </pre>
                  </p>
                </div>
                <div class="duik-callout duik-callout-primary mb-5">
                  <h4 class="h5">Метод <b><code>checkConfigData</code></b></h4>
                  <p class="mb-0">Проверяет на существование данные из файла config_data.php.</p>
                  <p class="mb-0">Если не передавать никаких параметров, то проверит главные данные.</p>
                  <p class="mb-0">Входные данные: (
                    <ol>
                      <li>Тип проверяемых данных, если мы в данном методе настроили их проверку - string - ОПЦИОНАЛЬНО</li>
                      <li>Дополнительная глубина проверки (для следующего слоя) - string - ОПЦИОНАЛЬНО</li>
                    </ol>
                  </p>
                  <p class="mb-0">Выходные данные: (
                    <ol>
                      <li>Ничего - значит удачно</li>
                      <li>Переадресация на страницу ошибки заполнения данных</li>
                    </ol>
                  </p>
                  <p class="mb-0">Необходимые главные настройки в config_data.php: (
                    <ol>
                      <li>UNBAN_LOGIN - логин старшего администратора, которого нельзя забанить</li>
                      <li>STANDART_TITLE - стандартное название вкладки страницы</li>
                      <li>STATUS_UNBAN - Статус пользователей, которых нельзя забанить (чаще всего админы) - только 1 число</li>
                      <li>EMAIL - Email для связи с администрацией</li>
                    </ol>
                  </p>
                  <p>Пример части файла:
                    <pre>
'UNBAN_LOGIN' => 'Admin',
'STANDART_TITLE' => 'IT Forum',
'STATUS_UNBAN' => 2,
'EMAIL' => 'aaa@aaa.aaa',
                    </pre>
                  </p>
                </div>
                <div class="duik-callout duik-callout-primary mb-5">
                  <h4 class="h5">Метод <b><code>relocate</code></b></h4>
                  <p class="mb-0">Перемещает пользователя на новый url.</p>
                  <p class="mb-0">Входные данные: (
                    <ol>
                      <li>Страница перемещения (/*модуль*/...), Модуль может иметь короткое название - string - ОБЯЗАТЕЛЬНО</li>
                      <li>Код ошибки на сайте (ниже представлен список) - int - ОПЦИОНАЛЬНО</li>
                      <li>Сообщение об ошибки в дополнение к кода - string - ОПЦИОНАЛЬНО (Обязательно, если есть код)</li>
                    </ol>
                  </p>
                  <p class="mb-0">Выходные данные: (
                    <ol>
                      <li>Перемещение пользователья по присланному пути (404 если не найдено)</li>
                    </ol>
                  </p>
                  <p class="mb-0">Возможные коды перемещения: (
                    <ol>
                      <li>-1 - Критическая ошибка (связанная с работой сайта, важная для администратора)</li>
                      <li>1 - Информация</li>
                      <li>2 - Удача</li>
                      <li>3 - Ошибка</li>
                    </ol>
                  </p>
                </div>
              </div>
              <div id="view">
                <h2 class="h4 font-weight-bold">Представление  <a class="js-anchor-link duik-anchorjs-link" href="#view" aria-label="Anchor" data-anchorjs-icon="#"></a></h2>
                <div class="duik-callout duik-callout-primary mb-5">
                  <h4 class="h5">Метод <b><code>rander</code></b></h4>
                  <p class="mb-0">Рендерит страницы по пораметрам.</p>
                  <p class="mb-0">Входные данные: (
                    <ol>
                      <li>Путь к представлению, начинается с названия модуля без начального <code>/</code> - string - ОБЯЗАТЕЛЬНО</li>
                      <li>Массив с передаваемыми данными (в представлении будет под переменной <code>$data</code>) - array - ОПЦИОНАЛЬНО</li>
                      <li>Дополнительный лейаут (например, менюшка, вдобавок к основной) - string - ОПЦИОНАЛЬНО</li>
                      <li>Титульное название страницы (по умолчанию задаётся в настройках) - string - ОПЦИОНАЛЬНО</li>
                    </ol>
                  </p>
                  <p class="mb-0">Выходные данные: (
                    <ol>
                      <li>Отрендеренная страница</li>
                      <li>Ошибка с описанием (например, что-то не найдено)</li>
                    </ol>
                  </p>
                </div>
                <div class="duik-callout duik-callout-primary mb-5">
                  <h4 class="h5">Метод <b><code>specialDataGet</code></b></h4>
                  <p class="mb-0">Получает данные из настроек <code>config_data.php</code>.</p>
                  <p class="mb-0">Подробно о нём расписано в модели.</p>
                </div>
                <div class="duik-callout duik-callout-primary mb-5">
                  <h4 class="h5">Метод <b><code>useViewTmp</code></b></h4>
                  <p class="mb-0">Подгружает части (<code>tmp</code> в проекте) представления на страницу.</p>
                  <p class="mb-0">Входные данные: (
                    <ol>
                      <li>Полное название модуля, в котором находится файл данной части (если он общесайтовый, то ставится <code>default</code>) - string - ОБЯЗАТЕЛЬНО</li>
                      <li>Название файла части - string - ОБЯЗАТЕЛЬНО</li>
                    </ol>
                  </p>
                  <p class="mb-0">Выходные данные: (
                    <ol>
                      <li>Код из файла части - string</li>
                      <li>Не найдена часть - вывод ошибки</li>
                    </ol>
                  </p>
                </div>
              </div>
            </div>

            <div id="next" class="mb-7">
              <h2 class="h4 font-weight-bold">Что дальше <a class="js-anchor-link duik-anchorjs-link" href="#next" data-anchorjs-icon="#"></a></h2>
              <p>Пока на этом всё! Позже документация будет обновляться!</p>
              <!-- <p>Следующая глава: <a target="_blank" href="../php-uni-forum_Documentation/system.html">Система</a>.</p> -->
            </div>


           
          </div>
          <!-- End Content -->

          <hr class="mt-7 mb-4">

        <!-- Footer -->
        </div>
        <!-- End Footer -->
      </main>
    </div>
  </div>

  <!-- Go to Top -->
  <a class="js-go-to duik-go-to" href="javascript:;">
    <span class="fa fa-arrow-up duik-go-to__inner"></span>
  </a>
  <!-- End Go to Top -->

  <!-- JS Global Compulsory -->
  <script src="../assets/vendor/jquery/dist/jquery.min.js"></script>
  <script src="../assets/vendor/jquery-migrate/dist/jquery-migrate.min.js"></script>
  <script src="../assets/vendor/popper.js/dist/umd/popper.min.js"></script>
  <script src="../assets/vendor/bootstrap/dist/js/bootstrap.min.js"></script>

  <!-- JS Implementing Plugins -->
  <script src="../assets/vendor/jquery-ui/jquery-ui.core.min.js"></script>
  <script src="../assets/vendor/jquery-ui/ui/widgets/menu.js"></script>
  <script src="../assets/vendor/jquery-ui/ui/widgets/mouse.js"></script>
  <script src="../assets/vendor/prism/prism.js"></script>

  <!-- JS -->
  <script src="../assets/js/main.js"></script>
</body>
</html>